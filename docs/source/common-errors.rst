Common Errors
==============

.. note::
	This section is still heavily under construction as we aggregate questions and answers into this document.

We hope you don't run into these errors. But if you do, we hope they will be a useful reference.

**Tip:** Use ``Ctrl+F`` (or ``Command+F``) in your browser to search this page, it'll be much faster!

.. note::
	WRF-GC has several output files. Most GEOS-Chem output is in the root CPU output file, ``rsl.out.0000``. **Look in this file for any GEOS-Chem related errors.** HEMCO-related errors are in ``HEMCO.log``. WRF-related errors can be in any of the files numbered ``rsl.error.*`` and ``rsl.out.*``. You may want to use ``tail -n 5 rsl.* | less`` to quickly look at all log files to identify errors.

.. warning::
	THe HEMCO error log, ``HEMCO.log``, only writes errors/warnings from the root process. In order to see HEMCO errors for all processes, edit ``HEMCO_Config.rc`` and set ``LogFile`` to ``*``. Then you will be able to see HEMCO logs for all processes in the ``rsl.out.*`` files.

Compiling errors
-----------------

error #7013: This module file was not generated by any release of this compiler.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Did you copy your WRF-GC directory from somewhere else? Some module files appear to be lingering over from a previous compile. Try running ``./clean -a``, reconfiguring WRF-GC (``./configure -hyb`` for WRFV3, ``./configure`` for WRFV4), and rebuliding (``./compile em_real``).

ld: cannot find -lGIGC -lHistory -lGeosCore -lHistory -lKpp -lGeosCore -lIsorropia -lHCOI -lHCOX -lHCO -lGeosUtil -lKpp -lHeaders -lNcUtils
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A few things to check:

1. Go to ``WRF/chem/gc/lib``. Do you see **all** these files?

.. code-block::

	WRF/chem/gc/lib$ ls
	libGeosCore.a  libGIGC.a  libHCOI.a  libHeaders.a  libIsorropia.a  libNcUtils.a
	libGeosUtil.a  libHCO.a   libHCOX.a  libHistory.a  libKpp.a        libObsPack.a

If yes, proceed to 2. If no, GEOS-Chem was not compiled correctly. Go to ``WRF/chem``, run ``make compile_chem``, then check if there are any errors.

2. Go to ``WRF/main/Makefile``. Search for something like ``chem/gc/lib``: ``... -L/n/home04/hplin/wrfgc_dev_202110/WRF/chem/gc/lib -lHistory ...``.

Does this path, which points to ``chem/gc/lib``, **exist** and **is correct**? Is is the same path as 1?

If no, go to step 3. **The error is because you (or someone) moved your WRF-GC directly after compiling it once. We can fix this.**

3. Move ``WRF/main/Makefile.bak`` to ``WRF/main/Makefile``. Make sure this replaced version does not have ``-lGIGC`` **anywhere** within this file. If yes, download a fresh copy of WRF and move the ``main/Makefile`` from there into ``WRF/main/Makefile``.

4. Now, go to ``WRF/chem``, run ``make compile_chem``. Verify that ``WRF/chem/main/Makefile`` has ``chem/gc/lib`` pointing to the right path. **Go back to the root WRF directory and compile again**: ``./compile em_real``. No clean is necessary.

WPS-related errors
-------------------

ERROR: The mandatory field TT was not found in any input data.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This is because GFS was updated in June 2019. Download and compile WPS version 4 (only WPS) and copy the ``ungrib.exe`` from WPS v4 and use that. `Haipeng has previously written on this <https://jimmielin.me/2019/wrf-3x-gfs-ungrib-error/>`_

WRF-related errors
------------------

ERROR: Mismatch between namelist and input file dimensions NOTE:       1 namelist vs input data inconsistencies found.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If you see an error similar to:

.. code-block::

	d01 2016-05-11_12:00:00  input_wrf.F: SIZE MISMATCH:  namelist   ide,jde,num_metgrid_levels=         245         181          27
	d01 2016-05-11_12:00:00  input_wrf.F: SIZE MISMATCH:  input file ide,jde,kde               =         245         181          32
	d01 2016-05-11_12:00:00 ---- ERROR: Mismatch between namelist and input file dimensions
	NOTE:       1 namelist vs input data inconsistencies found.

You've hit a problem where your meteorology data source (e.g., GFS) has updated **during your model run times!** This doesn't happen often but you are bound to run into it sometime - see the list of updates and their dates `on this changelog page <https://www.nco.ncep.noaa.gov/pmb/changes/>`_ from NOAA.

**If your model run time did go across two GFS/FNL updates:** Usually this can be fixed by making a custom data request, e.g., in FNL `at the NCAR/UCAR Research Data Archive (RDA) <https://rda.ucar.edu/datasets/ds083.2/index.html#!access>`__ with a consistent number of vertical levels, and this can be solved.

**If your model run time did not go across:** Then maybe you're using old data and ``num_metgrid_levels`` is different. For example, try changing the ``namelist.input`` so it has the right number (in this case ``32`` instead of ``27``). If this doesn't fix the issue, see above.

GEOS-CHEM USES A VERTICAL HYBRID-SIGMA GRID. WRF MUST BE CONFIGURED TO USE THIS GRID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If you see this warning in WRF-GC's run logs:

.. code-block::
	 =====================================================
	 |               W A R N I N G (WRF-GC)              |
	 =====================================================
	   GEOS-CHEM USES A VERTICAL HYBRID-SIGMA GRID.
	   WRF MUST BE CONFIGURED TO USE THIS GRID using the
	   namelist option &dynamics: hybrid_opt = 2, and
	   RECOMPILING with ./configure -hyb.

	   WE WERE *NOT* ABLE TO DETECT THIS IN YOUR WRF-GC
	   CONFIGURATION, WHICH MEANS THE VERTICAL LEVELS MAY
	   BE INACCURATE AND OUTRIGHT WRONG. PLEASE CHECK.
	 =====================================================

Make sure that:
* If you're running WRFV3, make sure WRF-GC was configured with ``./configure -hyb``. If not, you have to recompile. **Backup your namelist and HEMCO configuration**, and ``./clean -a``, ``./configure -hyb``, then ``./compile em_real`` in the WRF directory.
* You have ``hybrid_opt = 2`` in the ``&dynamics`` section of your ``namelist.input``.

GEOS-Chem related errors
------------------------

## INTEGRATE FAILED TWICE !!! 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If you see ``--> Step size too small: T + 10*H = T or H < Roundoff``, this means that the conditions in that grid box are not optimal and resulted in integration errors. Try a better set of initial / boundary conditions.

My NOx / HNO3 or nitrogen-related species are extremely high!
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If this is happening near the coast, this is a bug with the ParaNOx extension. Go to ``HEMCO_Config.rc`` and turn off the `ParaNOx` extension:

.. code-block::
    102     ParaNOx                : on    NO/NO2/O3/HNO3

Changing ``on`` to ``off``. We are looking for a more permanent fix.

FAST-JX (RD_XXX): REQUIRED FILE NOT FOUND
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Make sure you have updated ``input.geos``'s configuration with the correct path to the Fast-JX CHEM_INPUTS:

.. code-block::
	%%% PHOTOLYSIS MENU %%% :
	FAST-JX directory       : /n/holyscratch01/external_repos/GEOS-CHEM/gcgrid/data/ExtData/CHEM_INPUTS/FAST_JX/v2019-10/

Make sure to update the path on top of ``input.geos`` as well:

.. code-block::
	Root data directory     : /n/holyscratch01/external_repos/GEOS-CHEM/gcgrid/data/ExtData/

Data can be obtained from `GEOS-Chem input data <https://sites.wustl.edu/acag/geos-chem/geos-chem-input-data/>`__ at WUSTL.


HEMCO related errors
--------------------

HEMCO ERROR: Invalid time index in (file)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Check the file that it is pointing to. There are a few likely reasons:
* The file was corrupted / not fully downloaded. Try opening it with ``ncview`` and checking!
* This inventory does not have the appropriate file for this date/time.

mozbc related errors
---------------------

mo_wrfchem_lib.o: ... undefined reference to nf_open_ / nf_inq_varid_ / nf_get_vara_real_  / nf_close_ / nf_def_var_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This error when compiling ``mozbc`` is usually because the path to netCDF library, ``NETCDF_DIR``, is incorrect.

Make sure that your ``NETCDF_DIR`` is set to the root directory of your netCDF installation, where under ``$NETCDF_DIR/lib`` you can find the appropriate netCDF library (``libnetcdff.so``).

Red herrings
-------------
If you see anything on this list, this is not the root cause - **this means that there's an error somewhere else!**

HEMCO ERROR: MaxNest too low, cannot enter GET_TIMEIDX (hco_read_std_mod.F90)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Any kind of error that says ``HEMCO ERROR: MaxNest too low`` means that there is an error somewhere above, in ``HEMCO.log``. Check further!

forrtl: severe (408): fort: (2): Subscript #1 of the array LOC has value 11 which is greater than the upper bound of 10
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This means that there is an error in ``HEMCO.log`` - check the HEMCO log instead! Maybe inventories are missing, etc.

forrtl: severe (408): fort: (2): Subscript #1 of the array ZPJ has value 1 which is greater than the upper bound of -1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Same! Check `rsl.error.` files for **another error** - it may be hundreds of lines above (searching for ``GEOS-Chem ERROR:`` or ``REQUIRED FILE NOT FOUND`` helps).

This error indicates that another error occurred somewhere upstream.

forrtl: error (78): process killed (SIGTERM)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Check if your system has enough memory. Also, check ``rsl.out.0000`` -- this is usually an error within GEOS-Chem.

forrtl: severe (174): SIGSEGV, segmentation fault occurred
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Check if your system has enough memory and try to run with ``ulimit -c unlimited``, ``ulimit -s unlimited``.

This may also mean there is an error somewhere else upstream.

Not actually errors
--------------------

Cannot find -lGCHPint
^^^^^^^^^^^^^^^^^^^^^^

This is not an error, ignore. If you cannot successfully compile WRF-GC, there is an error above in the compile log.

Trapping levels are weird and they should not be equal
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This doesn't seem to be an issue. If your run was interrupted, there might be an error elsewhere.

47 more processes have sent help message help-mpi-btl-openib.txt / no device params found
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This is usually not an issue. If your run stopped, check all the other run files.